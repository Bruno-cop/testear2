-- AR2 e Projeto Delta ‚Äì Script Completo com Menu Organizado + Desativar e Minimizar

-- Evita conflitos ao rodar mais de uma vez
pcall(function()
    if getgenv().aimGui and getgenv().aimGui.Destroy then
        getgenv().aimGui:Destroy()
    end
end)

-- ‚öôÔ∏è CONFIGS GLOBAIS
getgenv().Aimlock = true
getgenv().AimPart = "Head"
getgenv().FOV = 50
getgenv().MaxDistance = 1000
getgenv().ESPEnabled = true
getgenv().MaxDistanceESP = 1000 -- Dist√¢ncia m√°xima ESP

-- SERVI√áOS
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local aiming = false

-- üîµ FOV CIRCLE
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 1.5
fovCircle.Filled = false
fovCircle.Color = Color3.fromRGB(255, 0, 255)
fovCircle.Transparency = 0.6
fovCircle.Visible = true

RunService.RenderStepped:Connect(function()
    fovCircle.Position = UserInputService:GetMouseLocation()
    fovCircle.Radius = getgenv().FOV
    fovCircle.Visible = getgenv().Aimlock
end)

-- üéØ Input bot√£o direito
UserInputService.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        aiming = true
    elseif input.KeyCode == Enum.KeyCode.RightShift then
        Frame.Visible = not Frame.Visible
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        aiming = false
    end
end)

-- üîç Fun√ß√£o: encontrar alvo
local function getClosestToMouse()
    local closest, shortest = nil, getgenv().FOV
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(getgenv().AimPart) then
            local part = player.Character[getgenv().AimPart]
            local screenPos, onScreen = Camera:WorldToViewportPoint(part.Position)
            local mousePos = UserInputService:GetMouseLocation()
            local distance = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
            local distanceFromPlayer = (Camera.CFrame.Position - part.Position).Magnitude

            if onScreen and distance < shortest and distanceFromPlayer <= getgenv().MaxDistance then
                closest = part
                shortest = distance
            end
        end
    end
    return closest
end

-- üéØ Aimlock
RunService.RenderStepped:Connect(function()
    if getgenv().Aimlock and aiming then
        local target = getClosestToMouse()
        if target then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Position)
        end
    end
end)

-- üëÄ ESP de Players
local function createESP(player)
    local box = Drawing.new("Square")
    box.Thickness = 1
    box.Filled = false

    local nameTag = Drawing.new("Text")
    nameTag.Size = 14
    nameTag.Center = true
    nameTag.Outline = true

    RunService.RenderStepped:Connect(function()
        if getgenv().ESPEnabled and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Humanoid") then
            local root = player.Character.HumanoidRootPart
            local head = player.Character:FindFirstChild("Head")
            local hum = player.Character.Humanoid

            local rootPos, rootVis = Camera:WorldToViewportPoint(root.Position)
            local headPos, headVis = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
            local legPos, legVis = Camera:WorldToViewportPoint(root.Position - Vector3.new(0, 3, 0))

            local dist = (Camera.CFrame.Position - root.Position).Magnitude

            if rootVis and headVis and legVis and hum.Health > 0 and dist <= getgenv().MaxDistanceESP then
                local height = math.abs(headPos.Y - legPos.Y)
                local width = height / 2
                box.Size = Vector2.new(width, height)
                box.Position = Vector2.new(rootPos.X - width/2, headPos.Y)
                box.Visible = true

                if player.Team == LocalPlayer.Team then
                    box.Color = Color3.fromRGB(0, 255, 0)
                    nameTag.Color = Color3.fromRGB(0, 255, 0)
                else
                    box.Color = Color3.fromRGB(255, 0, 0)
                    nameTag.Color = Color3.fromRGB(255, 0, 0)
                end

                nameTag.Position = Vector2.new(rootPos.X, headPos.Y - 16)
                nameTag.Text = player.Name .. " [" .. math.floor(dist) .. "m]"
                nameTag.Visible = true
            else
                box.Visible = false
                nameTag.Visible = false
            end
        else
            box.Visible = false
            nameTag.Visible = false
        end
    end)
end

for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        createESP(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    if player ~= LocalPlayer then
        createESP(player)
    end
end)

-- üü© GUI MENU ORGANIZADO
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
getgenv().aimGui = ScreenGui
ScreenGui.Name = "AimlockMenu"
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 220, 0, 360)
Frame.Position = UDim2.new(0, 20, 0, 100)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "üéØ Bruno.cop"
Title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 18

-- Fun√ß√µes de cria√ß√£o
local function createButton(parent, yPos, text)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(1, -20, 0, 30)
    btn.Position = UDim2.new(0, 10, 0, yPos)
    btn.Text = text
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.SourceSans
    btn.TextSize = 16
    return btn
end

local function createTextBox(parent, yPos, placeholder, default)
    local box = Instance.new("TextBox", parent)
    box.Size = UDim2.new(1, -20, 0, 30)
    box.Position = UDim2.new(0, 10, 0, yPos)
    box.PlaceholderText = placeholder
    box.Text = tostring(default)
    box.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    box.TextColor3 = Color3.new(1, 1, 1)
    box.Font = Enum.Font.SourceSans
    box.TextSize = 16
    return box
end

local y = 40
local gap = 40

-- üîπ Aimlock
local AimlockToggle = createButton(Frame, y, getgenv().Aimlock and "Desativar Aimlock" or "Ativar Aimlock")
AimlockToggle.MouseButton1Click:Connect(function()
    getgenv().Aimlock = not getgenv().Aimlock
    AimlockToggle.Text = getgenv().Aimlock and "Desativar Aimlock" or "Ativar Aimlock"
end)
y = y + gap

local AimPartBox = createTextBox(Frame, y, "Parte para mirar (ex: Head)", getgenv().AimPart)
AimPartBox.FocusLost:Connect(function()
    getgenv().AimPart = AimPartBox.Text
end)
y = y + gap

local FOVBox = createTextBox(Frame, y, "FOV (ex: 50)", getgenv().FOV)
FOVBox.FocusLost:Connect(function()
    local val = tonumber(FOVBox.Text)
    if val then getgenv().FOV = val end
end)
y = y + gap

local DistAimBox = createTextBox(Frame, y, "Dist√¢ncia M√°x. Aimlock (ex: 2000)", getgenv().MaxDistance)
DistAimBox.FocusLost:Connect(function()
    local val = tonumber(DistAimBox.Text)
    if val then getgenv().MaxDistance = val end
end)
y = y + gap

-- üîπ ESP
local ESPToggle = createButton(Frame, y, getgenv().ESPEnabled and "Desativar ESP" or "Ativar ESP")
ESPToggle.MouseButton1Click:Connect(function()
    getgenv().ESPEnabled = not getgenv().ESPEnabled
    ESPToggle.Text = getgenv().ESPEnabled and "Desativar ESP" or "Ativar ESP"
end)
y = y + gap

local ESPDistBox = createTextBox(Frame, y, "Dist√¢ncia M√°x. ESP (ex: 1000)", getgenv().MaxDistanceESP)
ESPDistBox.FocusLost:Connect(function()
    local val = tonumber(ESPDistBox.Text)
    if val then getgenv().MaxDistanceESP = val end
end)
y = y + gap

-- üîπ Desativar script
local DisableButton = createButton(Frame, y, "Desativar Script")
DisableButton.MouseButton1Click:Connect(function()
    if fovCircle then fovCircle:Remove() end
    if getgenv().aimGui then getgenv().aimGui:Destroy() end
    getgenv().Aimlock = false
    getgenv().ESPEnabled = false
end)

-- Minimizar/Restaurar Menu com RightShift
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightShift then
        Frame.Visible = not Frame.Visible
    end
end)
